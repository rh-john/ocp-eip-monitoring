---
# Grafana Instance for EIP Monitoring
apiVersion: grafana.integreatly.org/v1beta1
kind: Grafana
metadata:
  name: eip-monitoring-grafana
  namespace: eip-monitoring
  labels:
    app: eip-monitor
spec:
  config:
    auth:
      disable_login_form: "false"
    security:
      admin_user: "admin"
      admin_password: "admin"
    server:
      # For OpenShift Routes (reverse proxy without subpath), let Grafana auto-detect root_url
      # The template variables will be resolved from the Route request headers
      # Removing explicit root_url to allow auto-detection from X-Forwarded-* headers
  deployment:
    replicas: 1
    resources:
      limits:
        cpu: 500m
        memory: 512Mi
      requests:
        cpu: 100m
        memory: 128Mi
    spec:
      template:
        spec:
          containers:
            - name: grafana
              env:
                # Install plugins via GF_PLUGINS_PREINSTALL_SYNC environment variable
                # GF_INSTALL_PLUGINS is deprecated in Grafana 12+
                # Format: plugin1,plugin2,... (without versions to get latest)
                # Use GF_PLUGINS_PREINSTALL_SYNC to wait for installation (recommended)
                - name: GF_PLUGINS_PREINSTALL_SYNC
                  value: "jdbranham-diagram-panel,vonage-status-panel,grafana-clock-panel,boazreicher-mosaicplot-panel,grafana-polystat-panel,mckn-funnel-panel,digrich-bubblechart-panel"
  service:
    type: ClusterIP
  client:
    preferService: true
  route:
    metadata:
      labels:
        app.kubernetes.io/name: grafana
        app: eip-monitor
    spec:
      tls:
        termination: edge

