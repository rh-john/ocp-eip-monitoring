---
# COO MonitoringStack CR
# Deploys Prometheus and Alertmanager instances managed by COO
apiVersion: monitoring.rhobs/v1alpha1
kind: MonitoringStack
metadata:
  name: eip-monitoring-stack
  namespace: eip-monitoring
  labels:
    app: eip-monitor
    coo: eip-monitoring
    app.kubernetes.io/part-of: eip-monitoring-stack
spec:
  logLevel: info
  retention: 15d
  resourceSelector:
    matchLabels:
      app: eip-monitor
  # Resource limits for Prometheus and Alertmanager pods
  # Prevents resource exhaustion and ensures predictable performance
  resources:
    requests:
      cpu: 500m
      memory: 2Gi
    limits:
      cpu: 2000m
      memory: 4Gi
  prometheusConfig:
    # High availability: Use 2 replicas for redundancy
    # Provides redundancy and better query performance
    replicas: 2
    # External labels for multi-cluster scenarios and federation
    # Helps identify metrics source in federated or multi-cluster setups
    # Note: Update these values to match your cluster/environment
    externalLabels:
      cluster: "local"  # Update with actual cluster name
      environment: "sandbox"  # Update with actual environment (sandbox/dev/test)
      monitoring_type: "coo"
      app: "eip-monitor"
    # Persistent storage for Prometheus data
    # This ensures metrics are retained across pod restarts
    persistentVolumeClaim:
      accessModes:
        - ReadWriteOnce
      resources:
        requests:
          storage: 50Gi  # Adjust size based on retention period and metrics volume
      # storageClassName: gp3  # Uncomment and set to your cluster's storage class if needed
      # If not specified, uses the cluster's default storage class
